from Crypto.Util.number import inverse

a = 13
b = 37
a_inv = inverse(a, 256)

target_key = [
    0x10, 0x4f, 0xff, 0xcd, 0xe1, 0xfd, 0x5f, 0xb8,
    0x1e, 0xab, 0x27, 0xdb, 0x3d, 0xbd, 0x09, 0x07]

enc_flag  = [ 
    0x74, 0x6a, 0x7f, 0x70, 0x80, 0x6d, 0x73, 0x93, 0x7c, 0x81, 0x8d, 0x55,
    0x49, 0x86, 0x55, 0x71, 0x75, 0x4a, 0x83, 0x57, 0x73, 0x44, 0x87, 0x83,
    0x5c, 0x6d, 0x73, 0x6d, 0x6e, 0x59, 0x60, 0x71, 0x4a, 0x70, 0x70, 0x4d,
    0x88, 0x33, 0x71, 0x67, 0x5c, 0x6d, 0x5b, 0x32, 0x77, 0x44, 0x6f, 0x64,
    0x66, 0x58, 0x4d, 0x76, 0x38, 0x49, 0x60, 0x66, 0x76, 0x70, 0x45, 0x6f,
    0x3c, 0x64, 0x8d]


def getEnvVariable(s, a_inv, b):
    return [(a_inv * (s[i] - b * i)) % 256 for i in range(len(s))]

def generateSecretKey(e):
    seckey = []
    for i in range(16):
        seckey.append((e[i]) ^ i ^ 0x51)
    return seckey


def decryptflag(decryptionkey , encrypted_flag , len_enc):
    flag = []
    for i in range(len_enc):
        flag.append(encrypted_flag[i] - decryptionkey[i % len(decryptionkey)])
    return "".join(chr(x) for x in flag)





environ_key = getEnvVariable(target_key, a_inv, b)
dec_key = generateSecretKey(environ_key)
flag = decryptflag(dec_key , enc_flag , len(enc_flag))
print(flag)
